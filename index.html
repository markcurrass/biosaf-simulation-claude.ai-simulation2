<!DOCTYPE html>
<html lang="en-GB">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BioSAF Plant Interactive Simulation Dashboard (UK/EU)</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<style>
:root {
  --bg: #071029;
  --card: #0f1724;
  --muted: #9aa6b2;
  --accent: #06b6d4;
  --green: #10b981;
  --yellow: #f59e0b;
  --red: #ef4444;
  --purple: #8b5cf6;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(180deg, #031024, #071029);
  color: #e6eef6;
  padding: 20px;
  line-height: 1.6;
  min-height: 100vh;
}

.container {
  max-width: 1800px;
  margin: 0 auto;
}

.header {
  background: linear-gradient(135deg, rgba(6, 182, 212, 0.15), rgba(139, 92, 246, 0.15));
  border-radius: 16px;
  padding: 32px;
  margin-bottom: 24px;
  border: 1px solid rgba(6, 182, 212, 0.3);
}

.header h1 {
  margin: 0 0 12px 0;
  font-size: 2.5rem;
  color: var(--accent);
  font-weight: 700;
}

.header p {
  margin: 0;
  color: var(--muted);
  font-size: 1.1rem;
}

.tabs {
  display: flex;
  gap: 8px;
  margin-bottom: 24px;
  flex-wrap: wrap;
  background: rgba(15, 23, 36, 0.5);
  padding: 12px;
  border-radius: 12px;
}

.tab {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  color: #e6eef6;
  padding: 12px 24px;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s;
  font-weight: 500;
  font-size: 0.95rem;
}

.tab:hover {
  background: rgba(6, 182, 212, 0.1);
  border-color: var(--accent);
  transform: translateY(-2px);
}

.tab.active {
  background: var(--accent);
  color: #000;
  border-color: var(--accent);
  box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);
}

.card {
  background: var(--card);
  border-radius: 12px;
  padding: 24px;
  margin-bottom: 20px;
  border: 1px solid rgba(255,255,255,0.05);
  box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
}

.card-title {
  font-size: 1.35rem;
  font-weight: 600;
  margin-bottom: 16px;
  color: var(--accent);
}

.grid-2 {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
  gap: 20px;
}

.grid-3 {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 20px;
}

.grid-4 {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 16px;
}

.form-group {
  margin-bottom: 20px;
}

.form-group label {
  display: block;
  color: var(--muted);
  font-size: 0.875rem;
  font-weight: 600;
  margin-bottom: 8px;
  text-transform: uppercase;
}

.form-group select {
  width: 100%;
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  color: #e6eef6;
  padding: 12px 14px;
  border-radius: 8px;
  font-size: 1rem;
  transition: all 0.3s;
}

.slider-container {
  margin-bottom: 24px;
}

.slider-label {
  display: flex;
  justify-content: space-between;
  color: var(--muted);
  font-size: 0.875rem;
  margin-bottom: 8px;
  font-weight: 600;
}

.slider-value {
  color: var(--accent);
  font-weight: 700;
  font-size: 1rem;
}

input[type="range"] {
  width: 100%;
  height: 8px;
  border-radius: 4px;
  background: rgba(255, 255, 255, 0.1);
  outline: none;
  -webkit-appearance: none;
  cursor: pointer;
}

input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 22px;
  height: 22px;
  border-radius: 50%;
  background: var(--accent);
  cursor: pointer;
  box-shadow: 0 0 10px rgba(6, 182, 212, 0.5);
}

input[type="range"]::-moz-range-thumb {
  width: 22px;
  height: 22px;
  border-radius: 50%;
  background: var(--accent);
  cursor: pointer;
  border: none;
}

.metric-card {
  background: linear-gradient(135deg, rgba(6, 182, 212, 0.08), rgba(16, 185, 129, 0.08));
  padding: 24px;
  border-radius: 12px;
  border: 1px solid rgba(6, 182, 212, 0.2);
  text-align: center;
  transition: all 0.3s;
}

.metric-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 16px rgba(6, 182, 212, 0.2);
}

.metric-label {
  color: var(--muted);
  font-size: 0.875rem;
  text-transform: uppercase;
  margin-bottom: 8px;
  font-weight: 600;
}

.metric-value {
  font-size: 2.5rem;
  font-weight: 700;
  color: var(--accent);
  line-height: 1;
}

.metric-unit {
  font-size: 1rem;
  color: var(--muted);
  margin-top: 4px;
}

button {
  background: rgba(6, 182, 212, 0.15);
  border: 1px solid rgba(6, 182, 212, 0.3);
  color: var(--accent);
  padding: 12px 24px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 0.95rem;
  font-weight: 600;
  transition: all 0.3s;
  margin-right: 8px;
  font-family: inherit;
}

button:hover {
  background: rgba(6, 182, 212, 0.25);
  border-color: var(--accent);
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);
}

button.primary {
  background: linear-gradient(135deg, var(--accent), var(--green));
  color: #000;
  font-size: 1.1rem;
  padding: 16px 40px;
  border: none;
  box-shadow: 0 4px 16px rgba(6, 182, 212, 0.4);
}

button.primary:hover {
  box-shadow: 0 8px 24px rgba(6, 182, 212, 0.6);
}

.h2-card {
  cursor: pointer;
  transition: all 0.3s;
}

.h2-card.selected {
  border: 2px solid var(--accent);
  box-shadow: 0 0 20px rgba(6, 182, 212, 0.4);
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 16px;
}

th, td {
  padding: 14px;
  text-align: left;
  border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

th {
  color: var(--accent);
  font-weight: 600;
  font-size: 0.875rem;
  text-transform: uppercase;
  background: rgba(6, 182, 212, 0.05);
}

.warning-box {
  background: rgba(245, 158, 11, 0.1);
  border-left: 4px solid var(--yellow);
  padding: 16px;
  border-radius: 8px;
  margin-bottom: 16px;
}

@media (max-width: 768px) {
  .grid-2, .grid-3, .grid-4 {
    grid-template-columns: 1fr;
  }
  .header h1 {
    font-size: 1.8rem;
  }
}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>üõ©Ô∏è BioSAF Plant Interactive Simulation (UK/EU)</h1>
    <p>Modular Fischer-Tropsch SAF Production - Configure, Simulate, Optimise</p>
  </div>
  
  <div class="tabs" id="tabs"></div>
  <div id="content"></div>
</div>

<script>
// ============================================================================
// DATA MODELS (UK/EU)
// ============================================================================

const feedstockDatabase = {
  'forestry_residue': {
    name: 'Forestry Residue',
    moisture: 40,
    ashContent: 2.5,
    calorificValue: 19.5,
    cost: 38,
    carbon: 50.2,
    hydrogen: 6.1,
    oxygen: 42.5,
    sulfur: 0.02
  },
  'agricultural_waste': {
    name: 'Agricultural Waste',
    moisture: 15,
    ashContent: 8.5,
    calorificValue: 17.2,
    cost: 29,
    carbon: 46.8,
    hydrogen: 5.9,
    oxygen: 44.1,
    sulfur: 0.15
  },
  'energy_crops': {
    name: 'Energy Crops',
    moisture: 20,
    ashContent: 3.2,
    calorificValue: 18.8,
    cost: 54,
    carbon: 48.5,
    hydrogen: 6.3,
    oxygen: 43.8,
    sulfur: 0.08
  }
};

// ============================================================================
// APP STATE
// ============================================================================

const appState = {
  config: {
    feedstock: null,
    feedRate: 15,
    operatingHours: 8000,
    hydrogenSource: 'smr',
    economics: {
      safPrice: 5.00,
      naphthaPrice: 0.65,
      dieselPrice: 1.00,
      electricityPrice: 0.10,
      naturalGasPrice: 0.25,
      carbonPrice: 80,
      discountRate: 0.10,
      gridCO2Intensity: 0.23
    }
  },
  results: null,
  activeTab: 'configuration'
};

let charts = {};

// ============================================================================
// CALCULATIONS
// ============================================================================

function runSimulation() {
  if (!appState.config.feedstock) {
    alert('Please select a feedstock first!');
    return;
  }

  const fs = appState.config.feedstock;
  const feedRate = appState.config.feedRate;
  const opHours = appState.config.operatingHours;
  const h2Source = appState.config.hydrogenSource;

  // Feedstock prep
  const wetBiomass = feedRate;
  const dryBiomass = wetBiomass * (100 - fs.moisture) / 100 / 0.9;
  const prepElec = feedRate * 150;

  // Gasification
  const gasifierEff = 0.75;
  const syngasYield = 2.5 * gasifierEff * (1 - fs.ashContent / 200);
  const syngasFlow = dryBiomass * 1000 * syngasYield;

  const h2Pct = 15;
  const coPct = 20;
  const h2coRatio = h2Pct / coPct;

  // FT Synthesis
  const coFlow = syngasFlow * (coPct / 100);
  const h2Flow = syngasFlow * (h2Pct / 100);
  const h2Required = coFlow * 2.1;
  const h2Shortfall = Math.max(0, h2Required - h2Flow) / 11.2;

  const ftConv = 0.70;
  const coConverted = coFlow * ftConv;
  const liquidProd = coConverted * 0.625;
  const safOutput = liquidProd * 0.428 * 0.75 * 0.92 * 0.96;

  const naphthaOutput = liquidProd * 0.352 * 0.92;
  const dieselOutput = liquidProd * 0.428 * 0.25 * 0.92;

  // Hydrogen
  const h2Upgrading = liquidProd * 0.025;
  const totalH2 = h2Shortfall + h2Upgrading;

  // Energy
  const biomassEnergy = feedRate * 1000 * fs.calorificValue;
  const compressionPower = 1500 * (syngasFlow / 6500);
  let h2Power = 0;
  if (h2Source === 'electrolyzer') {
    h2Power = totalH2 * 55;
  }
  const totalElec = prepElec + 250 + compressionPower + 500 + h2Power;

  const safEnergy = safOutput * 43.5;
  const totalProductEnergy = safEnergy + naphthaOutput * 44.2 + dieselOutput * 43.1;
  const efficiency = (totalProductEnergy / biomassEnergy) * 100;

  // Economics
  const capexByH2 = {
    smr: 15000000,
    electrolyzer: 35000000,
    pipeline: 12000000
  };
  const totalCapex = capexByH2[h2Source];

  const feedstockCost = fs.cost * feedRate * opHours;
  const elecCost = (totalElec / 1000) * appState.config.economics.electricityPrice * opHours;
  
  let h2Cost = 0;
  if (h2Source === 'smr') {
    h2Cost = totalH2 * 3.5 * appState.config.economics.naturalGasPrice * opHours;
  } else if (h2Source === 'pipeline') {
    h2Cost = totalH2 * 3.75 * opHours;
  }

  const totalOpex = feedstockCost + elecCost + h2Cost + 2500000;

  const safML = (safOutput * opHours) / 800 / 1000;
  const safRevenue = safML * 1000000 * appState.config.economics.safPrice;
  const naphthaRev = naphthaOutput * opHours * appState.config.economics.naphthaPrice;
  const dieselRev = dieselOutput * opHours * appState.config.economics.dieselPrice;
  const totalRevenue = safRevenue + naphthaRev + dieselRev;

  const annualCashFlow = totalRevenue - totalOpex;
  const payback = totalCapex / annualCashFlow;
  
  let npv = -totalCapex;
  for (let y = 1; y <= 20; y++) {
    npv += annualCashFlow / Math.pow(1.1, y);
  }
  
  const irr = (annualCashFlow / totalCapex) * 100;
  const lcosaf = (totalCapex * 0.117 + totalOpex) / (safML * 1000000);

  // Environmental
  const safProdKg = safOutput * opHours;
  const fossilEmissions = safProdKg * 3.16;
  const processEmissions = fossilEmissions * (h2Source === 'electrolyzer' ? 0.15 : 0.35);
  const co2Reduction = ((fossilEmissions - processEmissions) / fossilEmissions) * 100;

  appState.results = {
    output: {
      safML: safML,
      safKgHr: safOutput,
      safTonnesYr: safOutput * opHours / 1000
    },
    gasification: {
      syngasFlow: syngasFlow,
      h2coRatio: h2coRatio
    },
    hydrogen: {
      required: totalH2
    },
    energyBalance: {
      electricityConsumption: totalElec,
      efficiency: efficiency
    },
    economics: {
      totalCapex: totalCapex,
      totalOpex: totalOpex,
      totalRevenue: totalRevenue,
      annualCashFlow: annualCashFlow,
      lcosaf: lcosaf,
      npv: npv,
      irr: irr,
      paybackPeriod: payback
    },
    environmental: {
      totalEmissions: processEmissions,
      co2Avoided: fossilEmissions - processEmissions,
      reductionPercentage: co2Reduction
    }
  };

  switchTab('simulation');
}

// ============================================================================
// UI RENDERING
// ============================================================================

function renderApp() {
  renderTabs();
  renderContent();
}

function renderTabs() {
  const tabs = [
    { id: 'configuration', name: '‚öôÔ∏è Configuration' },
    { id: 'simulation', name: 'üî¨ Results' },
    { id: 'economics', name: 'üí∞ Economics' }
  ];
  
  document.getElementById('tabs').innerHTML = tabs.map(t => `
    <div class="tab ${appState.activeTab === t.id ? 'active' : ''}" 
         onclick="switchTab('${t.id}')">
      ${t.name}
    </div>
  `).join('');
}

function renderContent() {
  const content = document.getElementById('content');
  
  if (appState.activeTab === 'configuration') {
    content.innerHTML = renderConfigTab();
  } else if (appState.activeTab === 'simulation') {
    content.innerHTML = renderSimulationTab();
  } else if (appState.activeTab === 'economics') {
    content.innerHTML = renderEconomicsTab();
  }
}

function renderConfigTab() {
  const feedstockOptions = Object.keys(feedstockDatabase).map(key => {
    const fs = feedstockDatabase[key];
    const selected = appState.config.feedstock?.name === fs.name ? 'selected' : '';
    return `<option value="${key}" ${selected}>${fs.name}</option>`;
  }).join('');
  
  return `
    <div class="grid-2">
      <div class="card">
        <div class="card-title">üåæ Feedstock Selection</div>
        <div class="form-group">
          <label>Feedstock Type</label>
          <select id="feedstockSelect" onchange="updateFeedstock(this.value)">
            <option value="">Select feedstock...</option>
            ${feedstockOptions}
          </select>
        </div>
        
        ${appState.config.feedstock ? `
          <table style="font-size: 0.9rem; margin-top: 12px;">
            <tr><td style="color: var(--muted); width: 50%;">Moisture</td><td><strong>${appState.config.feedstock.moisture}%</strong></td></tr>
            <tr><td style="color: var(--muted);">Ash Content</td><td><strong>${appState.config.feedstock.ashContent}%</strong></td></tr>
            <tr><td style="color: var(--muted);">Calorific Value</td><td><strong>${appState.config.feedstock.calorificValue} MJ/kg</strong></td></tr>
            <tr><td style="color: var(--muted);">Cost</td><td><strong>¬£${appState.config.feedstock.cost}/tonne</strong></td></tr>
          </table>
        ` : ''}
      </div>
      
      <div class="card">
        <div class="card-title">üè≠ Plant Configuration</div>
        
        <div class="slider-container">
          <div class="slider-label">
            <span>Feed Rate</span>
            <span class="slider-value" id="feedRateDisplay">${appState.config.feedRate} t/hr</span>
          </div>
          <input type="range" id="feedRate" min="10" max="25" value="${appState.config.feedRate}" 
                 oninput="updateFeedRate(this.value)">
        </div>
        
        <div class="slider-container">
          <div class="slider-label">
            <span>Operating Hours</span>
            <span class="slider-value" id="opHoursDisplay">${appState.config.operatingHours} hr/yr</span>
          </div>
          <input type="range" id="operatingHours" min="6000" max="8400" value="${appState.config.operatingHours}" step="100"
                 oninput="updateOperatingHours(this.value)">
        </div>
      </div>
    </div>
    
    <div class="card">
      <div class="card-title">‚ö° Hydrogen Source</div>
      <div class="grid-3">
        <div class="metric-card h2-card ${appState.config.hydrogenSource === 'electrolyzer' ? 'selected' : ''}" 
             onclick="selectHydrogenSource('electrolyzer')">
          <div style="font-weight: 600; margin-bottom: 12px;">PEM Electrolyser</div>
          <div style="font-size: 0.85rem; color: var(--muted);">
            ‚Ä¢ ¬£27M CAPEX<br>
            ‚Ä¢ Zero direct CO2<br>
            ‚Ä¢ 27 MW electrical
          </div>
        </div>
        
        <div class="metric-card h2-card ${appState.config.hydrogenSource === 'smr' ? 'selected' : ''}" 
             onclick="selectHydrogenSource('smr')">
          <div style="font-weight: 600; margin-bottom: 12px;">SMR + PSA</div>
          <div style="font-size: 0.85rem; color: var(--muted);">
            ‚Ä¢ ¬£15M CAPEX<br>
            ‚Ä¢ 9.5 kg CO2/kg H2<br>
            ‚Ä¢ Lowest OPEX
          </div>
        </div>
        
        <div class="metric-card h2-card ${appState.config.hydrogenSource === 'pipeline' ? 'selected' : ''}" 
             onclick="selectHydrogenSource('pipeline')">
          <div style="font-weight: 600; margin-bottom: 12px;">Pipeline Supply</div>
          <div style="font-size: 0.85rem; color: var(--muted);">
            ‚Ä¢ ¬£12M CAPEX<br>
            ‚Ä¢ ¬£3.75/kg delivered<br>
            ‚Ä¢ 98% reliability
          </div>
        </div>
      </div>
    </div>
    
    <div style="text-align: center; margin: 32px 0;">
      <button class="primary" onclick="runSimulation()">‚ñ∂Ô∏è RUN SIMULATION</button>
    </div>
  `;
}

function renderSimulationTab() {
  if (!appState.results) {
    return `
      <div class="card" style="text-align: center; padding: 60px;">
        <h2 style="color: var(--muted);">No simulation results yet</h2>
        <p style="color: var(--muted); margin: 20px 0;">Configure your plant and run a simulation.</p>
        <button onclick="switchTab('configuration')">Go to Configuration ‚Üí</button>
      </div>
    `;
  }
  
  const r = appState.results;
  
  return `
    <div class="grid-4" style="margin-bottom: 24px;">
      <div class="metric-card">
        <div class="metric-label">SAF Output</div>
        <div class="metric-value">${r.output.safML.toFixed(2)}</div>
        <div class="metric-unit">ML/year</div>
      </div>
      <div class="metric-card">
        <div class="metric-label">Efficiency</div>
        <div class="metric-value">${r.energyBalance.efficiency.toFixed(1)}</div>
        <div class="metric-unit">%</div>
      </div>
      <div class="metric-card">
        <div class="metric-label">LCOSAF</div>
        <div class="metric-value">¬£${r.economics.lcosaf.toFixed(2)}</div>
        <div class="metric-unit">/litre</div>
      </div>
      <div class="metric-card">
        <div class="metric-label">CO2 Reduction</div>
        <div class="metric-value">${r.environmental.reductionPercentage.toFixed(1)}</div>
        <div class="metric-unit">%</div>
      </div>
    </div>
    
    <div class="card">
      <div class="card-title">üìä Key Performance Indicators</div>
      <div class="grid-3">
        <div style="background: rgba(6, 182, 212, 0.08); padding: 18px; border-radius: 8px;">
          <div style="color: var(--muted); font-size: 0.875rem; margin-bottom: 6px;">Syngas Flow</div>
          <div style="font-size: 1.8rem; font-weight: 700; color: var(--accent);">
            ${r.gasification.syngasFlow.toFixed(0)} <span style="font-size: 1rem;">Nm¬≥/hr</span>
          </div>
        </div>
        
        <div style="background: rgba(6, 182, 212, 0.08); padding: 18px; border-radius: 8px;">
          <div style="color: var(--muted); font-size: 0.875rem; margin-bottom: 6px;">H2/CO Ratio</div>
          <div style="font-size: 1.8rem; font-weight: 700; color: var(--accent);">
            ${r.gasification.h2coRatio.toFixed(2)}
          </div>
        </div>
        
        <div style="background: rgba(16, 185, 129, 0.08); padding: 18px; border-radius: 8px;">
          <div style="color: var(--muted); font-size: 0.875rem; margin-bottom: 6px;">SAF Production</div>
          <div style="font-size: 1.8rem; font-weight: 700; color: var(--green);">
            ${r.output.safKgHr.toFixed(0)} <span style="font-size: 1rem;">kg/hr</span>
          </div>
        </div>
      </div>
    </div>
    
    <div class="card">
      <div class="card-title">üí∞ Economic Summary</div>
      <table>
        <tr><td>Total CAPEX</td><td><strong>¬£${(r.economics.totalCapex / 1000000).toFixed(1)}M</strong></td></tr>
        <tr><td>Annual OPEX</td><td><strong>¬£${(r.economics.totalOpex / 1000000).toFixed(1)}M</strong></td></tr>
        <tr><td>Annual Revenue</td><td><strong>¬£${(r.economics.totalRevenue / 1000000).toFixed(1)}M</strong></td></tr>
        <tr><td>Annual Cash Flow</td><td><strong>¬£${(r.economics.annualCashFlow / 1000000).toFixed(1)}M</strong></td></tr>
        <tr><td>NPV (20 years)</td><td><strong>¬£${(r.economics.npv / 1000000).toFixed(1)}M</strong></td></tr>
        <tr><td>IRR</td><td><strong>${r.economics.irr.toFixed(1)}%</strong></td></tr>
        <tr><td>Payback Period</td><td><strong>${r.economics.paybackPeriod.toFixed(1)} years</strong></td></tr>
      </table>
    </div>
    
    <div class="card">
      <div class="card-title">üåç Environmental Impact</div>
      <table>
        <tr><td>Process Emissions</td><td><strong>${(r.environmental.totalEmissions / 1000).toFixed(0)} tonnes CO2/year</strong></td></tr>
        <tr><td>CO2 Avoided</td><td><strong>${(r.environmental.co2Avoided / 1000).toFixed(0)} tonnes/year</strong></td></tr>
        <tr><td>Reduction vs Fossil</td><td><strong>${r.environmental.reductionPercentage.toFixed(1)}%</strong></td></tr>
      </table>
    </div>
  `;
}

function renderEconomicsTab() {
  if (!appState.results) {
    return `<div class="card loading"><h2>Run a simulation first</h2></div>`;
  }
  
  const r = appState.results;
  
  return `
    <div class="grid-3" style="margin-bottom: 24px;">
      <div class="metric-card">
        <div class="metric-label">Total CAPEX</div>
        <div class="metric-value">¬£${(r.economics.totalCapex / 1000000).toFixed(1)}</div>
        <div class="metric-unit">Million</div>
      </div>
      <div class="metric-card">
        <div class="metric-label">Annual OPEX</div>
        <div class="metric-value">¬£${(r.economics.totalOpex / 1000000).toFixed(1)}</div>
        <div class="metric-unit">Million/year</div>
      </div>
      <div class="metric-card">
        <div class="metric-label">LCOSAF</div>
        <div class="metric-value">¬£${r.economics.lcosaf.toFixed(2)}</div>
        <div class="metric-unit">/litre</div>
      </div>
    </div>
    
    <div class="card">
      <div class="card-title">üìä Financial Metrics</div>
      <div class="grid-4" style="margin-top: 20px;">
        <div style="background: rgba(6, 182, 212, 0.08); padding: 20px; border-radius: 8px;">
          <div style="color: var(--muted); font-size: 0.875rem; margin-bottom: 8px;">NPV (20yr)</div>
          <div style="font-size: 2rem; font-weight: 700; color: ${r.economics.npv > 0 ? 'var(--green)' : 'var(--red)'};">
            ¬£${(r.economics.npv / 1000000).toFixed(1)}M
          </div>
        </div>
        
        <div style="background: rgba(16, 185, 129, 0.08); padding: 20px; border-radius: 8px;">
          <div style="color: var(--muted); font-size: 0.875rem; margin-bottom: 8px;">IRR</div>
          <div style="font-size: 2rem; font-weight: 700; color: var(--green);">
            ${r.economics.irr.toFixed(1)}%
          </div>
        </div>
        
        <div style="background: rgba(6, 182, 212, 0.08); padding: 20px; border-radius: 8px;">
          <div style="color: var(--muted); font-size: 0.875rem; margin-bottom: 8px;">Payback</div>
          <div style="font-size: 2rem; font-weight: 700; color: var(--accent);">
            ${r.economics.paybackPeriod.toFixed(1)} yrs
          </div>
        </div>
        
        <div style="background: rgba(16, 185, 129, 0.08); padding: 20px; border-radius: 8px;">
          <div style="color: var(--muted); font-size: 0.875rem; margin-bottom: 8px;">Cash Flow</div>
          <div style="font-size: 2rem; font-weight: 700; color: var(--green);">
            ¬£${(r.economics.annualCashFlow / 1000000).toFixed(1)}M
          </div>
        </div>
      </div>
    </div>
  `;
}

// ============================================================================
// EVENT HANDLERS
// ============================================================================

function switchTab(tabId) {
  appState.activeTab = tabId;
  renderApp();
}

function updateFeedstock(key) {
  if (key) {
    appState.config.feedstock = feedstockDatabase[key];
  }
  renderApp();
}

function updateFeedRate(value) {
  appState.config.feedRate = parseFloat(value);
  document.getElementById('feedRateDisplay').textContent = `${value} t/hr`;
}

function updateOperatingHours(value) {
  appState.config.operatingHours = parseInt(value);
  document.getElementById('opHoursDisplay').textContent = `${value} hr/yr`;
}

function selectHydrogenSource(source) {
  appState.config.hydrogenSource = source;
  renderApp();
}

// ============================================================================
// INITIALIZATION
// ============================================================================

document.addEventListener('DOMContentLoaded', () => {
  appState.config.feedstock = feedstockDatabase['forestry_residue'];
  renderApp();
});

// Make functions global
window.switchTab = switchTab;
window.updateFeedstock = updateFeedstock;
window.updateFeedRate = updateFeedRate;
window.updateOperatingHours = updateOperatingHours;
window.selectHydrogenSource = selectHydrogenSource;
window.runSimulation = runSimulation;
</script>
</body>
</html>